<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <header>
    <div class="logo">
      <span>üìÑ</span> ForgeCV
    </div>
    <div class="controls">
      <button id="profileToggle" class="icon-btn" title="Manage Profile">üë§</button>
      <button id="settingsToggle" class="icon-btn" title="Settings">‚öôÔ∏è</button>
    </div>
  </header>

  <div id="quickStatus" class="quick-status"></div>

  <div id="status"></div>

  <!-- Settings UI -->
  <div id="settingsUI" class="hidden">
    <div class="flex-between" style="margin-bottom: 16px; align-items: flex-start;">
      <div>
        <h3 style="margin:0; color:var(--text-main);">Settings</h3>
        <p class="text-xs text-muted">Configure how you power your AI actions.</p>
      </div>
      <button id="backFromSettings" class="secondary-btn icon-btn"
        style="width:auto; padding: 4px 8px; font-size:11px;">‚úï</button>
    </div>

    <!-- Auth Section (Injected by ui.js) -->
    <div id="authSection" class="auth-section"></div>

    <div class="mode-toggle">
      <button id="modeFreeBtn" class="mode-btn active" data-mode="free">‚ö° Free Tier</button>
      <button id="modeByokBtn" class="mode-btn" data-mode="byok">üîë Your Own Keys</button>
    </div>

    <div class="settings-card">
      <!-- Free Tier Info -->
      <div id="freeModeInfo" class="mode-info">
        <div id="freeUsageDisplay"></div>
        <div id="freeLoginPrompt" class="hidden">
          <p class="text-sm">Sign in to activate 15 free AI actions per day.</p>
          <button id="googleLoginBtn" class="google-btn">
            <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" alt="Google">
            Sign in with Google
          </button>
        </div>
      </div>

      <!-- BYOK Settings -->
      <div id="byokSettings" class="mode-info hidden">
        <div class="edit-field">
          <label for="providerSelect">AI Provider</label>
          <select id="providerSelect">
            <option value="gemini">Google Gemini (Recommended)</option>
            <option value="groq">Groq (Llama 3)</option>
            <option value="openrouter">OpenRouter (Multi-Model)</option>
          </select>
        </div>

        <div id="geminiKeyData" class="key-section">
          <label for="apiKey">Gemini API Key</label>
          <input type="password" id="apiKey" placeholder="Enter Gemini API Key">
          <details class="help-details">
            <summary>How to get a Free Gemini API Key</summary>
            <div style="margin-bottom:8px; font-weight:600; color:var(--success);">‚ú® One-time setup. Using free tier.
            </div>
            <ol>
              <li>Go to <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>.</li>
              <li>Click <strong>"Get API key"</strong>.</li>
              <li>Copy and paste the key above.</li>
            </ol>
          </details>
        </div>

        <div id="groqKeyData" class="key-section hidden">
          <label for="groqApiKey">Groq API Key</label>
          <input type="password" id="groqApiKey" placeholder="Enter Groq API Key">
          <details class="help-details">
            <summary>How to get a Free Groq Key</summary>
            <ol>
              <li>Go to <a href="https://console.groq.com/keys" target="_blank">Groq Console</a>.</li>
              <li>Create an API Key and paste it above.</li>
            </ol>
          </details>
        </div>

        <div id="openrouterKeyData" class="key-section hidden">
          <label for="openrouterApiKey">OpenRouter API Key</label>
          <input type="password" id="openrouterApiKey" placeholder="Enter OpenRouter API Key">
          <details class="help-details">
            <summary>How to get a Free OpenRouter Key</summary>
            <ol>
              <li>Go to <a href="https://openrouter.ai/keys" target="_blank">OpenRouter Keys</a>.</li>
              <li>Create a key and paste it above.</li>
            </ol>
          </details>
        </div>

        <p class="text-xs text-muted" style="margin-top: 12px; font-style: italic;">
          Unlimited generations ¬∑ Your keys stay on <b>your</b> device
        </p>
      </div>

      <button id="saveSettingsBtn" class="primary-btn" style="width:100%; margin-top:16px;">Save & Apply</button>

      <div id="settingsStatus"></div>
    </div>

    <p class="text-center text-xs text-muted" style="margin-top: 16px; padding: 0 10px;">
      Free tier uses open-source AI models via ForgeCV servers. For best quality and unlimited use, bring your own
      Gemini key.
    </p>
  </div>

  <!-- Profile Management UI -->
  <div id="profileUI" class="hidden">
    <div class="flex-between" style="margin-bottom: 16px;">
      <h3>Manage Profile</h3>
      <button id="backFromProfile" class="secondary-btn icon-btn"
        style="width:auto; padding: 4px 8px; font-size:11px;">‚úï</button>
    </div>

    <div class="card" style="margin-bottom: 12px;">
      <h4 style="margin-bottom: 10px;">üìÇ Profiles</h4>
      <div id="profileList" style="margin-bottom: 10px;"></div>
      <div style="display: flex; gap: 8px;">
        <input type="text" id="newProfileName" placeholder="New profile name..."
          style="flex: 1; font-size: 12px; padding: 8px;">
        <button id="createProfileBtn" class="secondary-btn"
          style="white-space: nowrap; font-size: 12px; padding: 8px 12px;">+ Create</button>
      </div>
    </div>

    <div class="card">
      <h4 style="margin-bottom:12px;">üìÑ Re-upload Base Resume</h4>
      <input type="file" id="reuploadResumeFile" accept=".pdf" style="margin-bottom:10px;">
      <button id="reuploadBtn" class="primary-btn" style="width:100%;">Upload New Resume</button>

      <div class="divider-or"><span>OR LINKEDIN</span></div>

      <div style="margin-bottom:12px;">
        <label
          style="font-size:11px; font-weight:600; color:var(--text-secondary); display:block; margin-bottom:6px;">Upload
          LinkedIn PDF</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <input type="file" id="reuploadLinkedinPdf" accept=".pdf" style="flex:1;">
          <button id="reuploadLinkedinPdfBtn" class="primary-btn"
            style="white-space:nowrap; padding:8px 12px; font-size:11px;">Upload</button>
        </div>
      </div>

      <div>
        <label
          style="font-size:11px; font-weight:600; color:var(--text-secondary); display:block; margin-bottom:6px;">Or
          paste LinkedIn URL</label>
        <div style="display:flex; gap:8px;">
          <input type="text" id="reuploadLinkedinUrl" placeholder="https://linkedin.com/in/..."
            style="flex:1; font-size:11px;">
          <button id="reuploadLinkedinUrlBtn" class="secondary-btn"
            style="white-space:nowrap; padding:8px 12px; font-size:11px;">üîç Fetch</button>
        </div>
      </div>

      <div class="divider-or"><span>OR PASTE TEXT</span></div>

      <textarea id="reuploadResumeText" placeholder="Paste full resume text..." style="height: 80px;"></textarea>
      <button id="reuploadTextBtn" class="primary-btn" style="width:100%; margin-top:8px;">Process Text</button>
    </div>

    <div class="card">
      <h4 style="margin-bottom:12px;">‚úèÔ∏è Manual Edit</h4>
      <label for="profileSectionSelect" class="text-sm text-muted">Select Section:</label>
      <select id="profileSectionSelect" style="margin-bottom:12px;">
        <option value="summary">Summary</option>
        <option value="contact">Contact Info</option>
        <option value="education">Education</option>
        <option value="experience">Experience</option>
        <option value="projects">Projects</option>
        <option value="skills">Skills</option>
        <option value="leadership">Leadership</option>
        <option value="research">Research & Publications</option>
        <option value="certifications">Certifications</option>
        <option value="awards">Awards & Honors</option>
        <option value="volunteering">Volunteering</option>
        <option value="languages">Languages</option>
      </select>

      <div id="profileFormContainer" style="max-height: 400px; overflow-y: auto;"></div>

      <div class="flex-between" style="gap:10px; margin-top:16px;">
        <button id="saveProfileBtn" class="primary-btn" style="flex:1;">Save Changes</button>
        <button id="cancelProfileEditBtn" class="secondary-btn" style="flex:1;">Cancel</button>
      </div>
    </div>
    <div id="profileStatus"></div>
  </div>

  <!-- Setup UI -->
  <div id="setupUI" class="hidden">
    <div class="upload-zone">
      <h2 style="font-size:18px; margin-bottom:4px;">Welcome to ForgeCV</h2>
      <p class="text-muted" style="margin-bottom:4px; font-size: 12px;">AI-powered resume tailoring in 3 steps:</p>
      <div
        style="text-align: left; margin: 0 auto 16px; max-width: 260px; font-size: 11px; color: var(--text-secondary);">
        <div style="margin-bottom: 4px;">1Ô∏è‚É£ Upload your base resume (PDF or text)</div>
        <div style="margin-bottom: 4px;">2Ô∏è‚É£ Navigate to a job posting page</div>
        <div>3Ô∏è‚É£ Click "Generate" ‚Äî AI tailors your resume to the job</div>
      </div>

      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0;">Setup</h3>
        <button id="backFromSetup" class="secondary-btn" style="font-size:11px; padding:4px 8px;">Back</button>
      </div>

      <!-- Primary: PDF Upload -->
      <div id="methodUpload" class="setup-hero-upload">
        <div class="upload-zone" id="uploadDropZone">
          <div class="upload-zone-content">
            <span class="upload-icon">üìÑ</span>
            <p class="upload-title">Upload Your Resume</p>
            <p class="upload-subtitle">Drop a PDF here or click to browse</p>
            <input type="file" id="resumeFile" accept=".pdf" style="display:none">
            <button id="uploadBtn" class="upload-choose-btn">Choose PDF File</button>
          </div>
        </div>
        <div id="uploadStatus" style="margin-top:8px;"></div>
      </div>

      <!-- Alternative methods ‚Äî collapsed -->
      <details class="alt-methods-details">
        <summary class="alt-methods-toggle">
          <span>Other ways to import</span>
          <span class="toggle-chevron">‚ñæ</span>
        </summary>
        <div class="alt-methods-content">
          <!-- LinkedIn Import -->
          <div class="alt-method-card" id="methodLinkedIn">
            <div class="alt-method-header">
              <span>üîó</span>
              <div>
                <strong>Import from LinkedIn</strong>
                <span class="alt-method-note">Opens your profile in a new tab</span>
              </div>
            </div>
            <div style="display:flex; gap:6px; margin-top:8px;">
              <input type="text" id="linkedinUrlInput" placeholder="https://linkedin.com/in/your-profile"
                style="flex:1; font-size:11px; padding:8px;">
              <button id="fetchLinkedinBtn" class="primary-btn"
                style="padding:8px 12px; font-size:11px; white-space:nowrap;">üîç Fetch</button>
            </div>
            <div class="alt-method-warning">
              ‚ö†Ô∏è LinkedIn may limit data visibility. PDF upload gives better results.
            </div>
            <div id="linkedinUrlStatus" style="margin-top:6px;"></div>
          </div>

          <!-- Paste Text -->
          <div class="alt-method-card" id="methodText">
            <div class="alt-method-header">
              <span>üìù</span>
              <div>
                <strong>Paste Resume Text</strong>
                <span class="alt-method-note">Copy-paste from any source</span>
              </div>
            </div>
            <textarea id="resumeTextInit" placeholder="Paste your full resume text here..."
              style="height:100px; margin-top:8px; font-size:11px;"></textarea>
            <button id="processTextInitBtn" class="primary-btn"
              style="width:100%; margin-top:8px; font-size:12px;">Process Text</button>
            <div id="textStatus" style="margin-top:6px;"></div>
          </div>
        </div>
      </details>

      <!-- How it works ‚Äî collapsed -->
      <details class="how-it-works-details">
        <summary class="how-it-works-toggle">‚ÑπÔ∏è How does ForgeCV work?</summary>
        <div class="how-it-works-content">
          <p><strong>Your data is private.</strong> Your resume and API key stay on your device.</p>
          <p><strong>Step 1:</strong> Upload your resume once. ForgeCV extracts and stores your profile locally.</p>
          <p><strong>Step 2:</strong> Open any job posting. ForgeCV reads the job description from the page.</p>
          <p><strong>Step 3:</strong> Click Forge. AI rewrites your resume to match the job's keywords.</p>
          <p><strong>Step 4:</strong> Download the tailored PDF or copy content directly.</p>
        </div>
      </details>
      <div style="margin-top: 12px; text-align: center; font-size: 10px; color: var(--text-muted);">
        ‚ú® Trusted by job seekers. Powered by AI. Zero data leaves your device.
      </div>
      <div style="margin-top: 12px; text-align: center; font-size: 10px; color: var(--text-muted);">
        ‚ú® Trusted by job seekers. Powered by AI. Zero data leaves your device.
      </div>
    </div>
  </div>

  <!-- Main UI -->
  <div id="mainUI" class="hidden">
    <div id="usageLimitBanner" class="hidden"></div>
    <div class="profile-bar">
      <div class="profile-bar-left">
        <span class="profile-avatar-mini">üë§</span>
        <span id="profileName" class="profile-name-text">User</span>
        <span id="activeProfileLabel" class="profile-label-badge"></span>
        <span id="atsScoreBadge" class="ats-badge" style="display:none;"></span>
      </div>
      <div class="profile-bar-right">
        <span id="activeTabUrl" class="active-tab-label"></span>
      </div>
    </div>

    <!-- JD Detection Card ‚Äî compact -->
    <div class="jd-card">
      <div class="jd-card-main">
        <div class="jd-status-indicator">
          <div id="jdStatusDot" class="jd-dot"></div>
          <div class="jd-status-text">
            <span id="jdStatusText" class="jd-title">No job description detected</span>
            <span id="jdSourceUrl" class="jd-source"></span>
          </div>
        </div>
        <div class="jd-actions">
          <button id="fetchJdBtn" class="jd-fetch-btn" title="Scan current page for job description">Fetch</button>
          <button id="manualJdBtn" class="jd-manual-btn" title="Paste job description manually">‚úé</button>
        </div>
      </div>

      <!-- Manual JD Input (hidden by default) -->
      <div id="manualJdInput" style="display:none;" class="jd-manual-panel">
        <textarea id="manualJdText" placeholder="Paste the full job description text here..."
          class="jd-manual-textarea"></textarea>
        <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
          <span style="font-size: 10px; color: var(--text-muted);">or</span>
          <label style="font-size: 11px; color: var(--primary); cursor: pointer; font-weight: 500;" for="jdPdfFile">üìé
            Upload JD PDF</label>
          <input type="file" id="jdPdfFile" accept=".pdf" style="display: none;">
          <span id="jdPdfFileName" style="font-size: 10px; color: var(--text-secondary);"></span>
        </div>
        <div style="display: flex; gap: 6px; margin-top: 10px;">
          <button id="saveManualJdBtn" class="primary-btn" style="flex: 1; font-size: 11px; padding: 8px;">‚úÖ Use This
            JD</button>
          <button id="cancelManualJdBtn" class="secondary-btn"
            style="flex: 1; font-size: 11px; padding: 8px;">Cancel</button>
        </div>
      </div>

      <!-- JD Preview (hidden by default) -->
      <div id="jdPreviewContainer" style="display: none;" class="jd-preview-panel">
        <div class="flex-between" style="margin-bottom: 4px;">
          <span
            style="font-size: 9px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Current
            JD</span>
          <button id="toggleJdPreviewBtn" class="jd-expand-btn">Expand</button>
        </div>
        <div style="position: relative;">
          <textarea id="jdPreviewText" class="jd-preview-textarea" placeholder="No JD content loaded..."></textarea>
          <div id="jdEditSaveContainer" style="display: none; position: absolute; bottom: 4px; right: 4px;">
            <button id="saveJdEditBtn" class="primary-btn"
              style="padding: 3px 8px; font-size: 9px; height: 20px; width: auto;">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Forge Section ‚Äî Primary CTA -->
    <div class="forge-section">
      <button id="generateBtn" class="forge-btn">
        <span class="forge-btn-icon">üî•</span>
        <div class="forge-btn-text">
          <span class="forge-btn-title">Forge My Resume</span>
          <span class="forge-btn-desc">AI tailors your resume to match the job description</span>
        </div>
      </button>

      <!-- Forge Options ‚Äî collapsed by default -->
      <details class="forge-options-details" id="forgeOptionsDetails">
        <summary class="forge-options-toggle">
          <span>‚öôÔ∏è Forge Options</span>
          <span class="toggle-chevron">‚ñæ</span>
        </summary>
        <div class="forge-options-content">
          <!-- Tailoring Strategy -->
          <div class="forge-option-group">
            <label class="forge-option-label">Tailoring Strength</label>
            <input type="range" id="tailoringSlider" min="0" max="2" value="1" step="1" class="forge-slider">
            <div class="strategy-labels">
              <span>üõ° Preserve</span>
              <span>‚öñÔ∏è Balanced</span>
              <span>üéØ Aggressive</span>
            </div>
            <div id="strategyDescription" class="forge-option-desc">
              Balanced ‚Äî integrates JD keywords while keeping it authentic
            </div>
          </div>

          <!-- Page Mode -->
          <div class="forge-option-group">
            <label class="forge-option-label">Page Length</label>
            <div class="page-mode-toggle-bar">
              <button id="pageMode1" class="page-mode-btn active" data-mode="1page">1 Page</button>
              <button id="pageMode2" class="page-mode-btn" data-mode="2page">2 Pages</button>
            </div>
          </div>

          <!-- Export Base (no AI) -->
          <button id="generateBaseBtn" class="forge-base-btn">
            üìÑ Export without AI
            <span class="forge-base-desc">Download your base profile as PDF ‚Äî no tailoring</span>
          </button>
        </div>
      </details>
    </div>

    <!-- Actions (Post-Generation) -->
    <div id="actions" class="hidden">
      <!-- Primary Actions ‚Äî always visible, large -->
      <div class="actions-primary">
        <button id="previewBtn" class="action-btn action-primary">
          <span class="action-icon">üîç</span>
          <span class="action-label">Preview</span>
          <span class="action-desc">Open PDF in new tab</span>
        </button>
        <button id="downloadBtn" class="action-btn action-primary">
          <span class="action-icon">‚¨áÔ∏è</span>
          <span class="action-label">Download</span>
          <span class="action-desc">Save PDF to your device</span>
        </button>
      </div>

      <!-- Edit Actions ‚Äî always visible, medium -->
      <div class="actions-edit">
        <button id="editBtn" class="action-btn action-secondary">
          <span class="action-icon">‚úèÔ∏è</span>
          <span class="action-label">Fine-Tune</span>
          <span class="action-desc">Edit bullets & sections</span>
        </button>
        <button id="copyContentBtn" class="action-btn action-secondary">
          <span class="action-icon">üìã</span>
          <span class="action-label">Copy</span>
          <span class="action-desc">Copy text to clipboard</span>
        </button>
      </div>

      <!-- More Actions ‚Äî collapsed by default -->
      <details class="more-actions-details">
        <summary class="more-actions-toggle">
          <span>More tools</span>
          <span class="toggle-chevron">‚ñæ</span>
        </summary>
        <div class="actions-more">
          <button id="analyzeBtn" class="action-btn action-tertiary">
            <span class="action-icon">üìä</span>
            <span class="action-label">ATS Score</span>
            <span class="action-desc">AI keyword analysis</span>
          </button>
          <button id="formatBtn" class="action-btn action-tertiary">
            <span class="action-icon">üé®</span>
            <span class="action-label">Style</span>
            <span class="action-desc">Font, margins, layout</span>
          </button>
          <button id="historyBtn" class="action-btn action-tertiary">
            <span class="action-icon">üï∞</span>
            <span class="action-label">History</span>
            <span class="action-desc">Past generated resumes</span>
          </button>
        </div>
      </details>

      <!-- Drag and drop feature removed -->

      <!-- Generation Progress -->
      <div id="generationProgress" class="hidden card" style="margin-top: 16px;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
          <div id="progressSpinner" class="spinner"></div>
          <span id="progressStepText" style="font-weight: 500; font-size: 13px;">Preparing...</span>
        </div>
        <div id="progressBar" style="height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
          <div id="progressFill"
            style="height: 100%; width: 0%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.5s ease;">
          </div>
        </div>
        <div id="progressDetail" class="text-sm text-muted" style="margin-top: 6px; font-size: 11px;"></div>
      </div>
      <div id="diffSummaryContainer"></div>
    </div>

    <!-- Copy UI -->
    <div id="copyUI" class="hidden card">
      <div class="flex-between">
        <h3>Copy Content</h3>
        <button id="closeCopyBtn" class="secondary-btn icon-btn">‚úï</button>
      </div>
      <div id="copyList"></div>
    </div>

    <!-- Format Settings UI -->
    <div id="formatUI" class="hidden card">
      <!-- Header -->
      <div class="format-header">
        <h3 class="format-title">Resume Style</h3>
        <button id="closeFormatBtn" class="editor-icon-btn" title="Close">‚úï</button>
      </div>

      <!-- Quick Presets -->
      <div class="format-presets">
        <label class="format-section-label">Quick Presets</label>
        <div class="preset-grid">
          <button class="preset-btn" id="presetCompact">
            <span class="preset-icon">üìê</span>
            <span class="preset-name">Compact</span>
            <span class="preset-desc">Small text, narrow margins ‚Äî fits more content</span>
          </button>
          <button class="preset-btn preset-active" id="presetStandard">
            <span class="preset-icon">üìÑ</span>
            <span class="preset-name">Standard</span>
            <span class="preset-desc">Clean, professional, balanced spacing</span>
          </button>
          <button class="preset-btn" id="presetSpacious">
            <span class="preset-icon">üì∞</span>
            <span class="preset-name">Spacious</span>
            <span class="preset-desc">Larger text, wide margins ‚Äî easy to read</span>
          </button>
        </div>
      </div>

      <!-- Fine-tune ‚Äî collapsed -->
      <details class="finetune-details">
        <summary class="finetune-toggle">
          <span>üéõÔ∏è Fine-tune individual settings</span>
          <span class="toggle-chevron">‚ñæ</span>
        </summary>
        <div class="finetune-content">

          <!-- Font -->
          <div class="finetune-group">
            <label class="format-section-label">Font</label>
            <div class="finetune-btn-row">
              <button class="format-option" data-setting="font" data-value="times"
                style="font-family:'Times New Roman',serif;">Times</button>
              <button class="format-option" data-setting="font" data-value="helvetica"
                style="font-family:Helvetica,Arial,sans-serif;">Helvetica</button>
              <button class="format-option" data-setting="font" data-value="courier"
                style="font-family:'Courier New',monospace;">Courier</button>
            </div>
          </div>

          <!-- Density -->
          <div class="finetune-group">
            <label class="format-section-label">Density</label>
            <div class="finetune-btn-row">
              <button class="format-option" data-setting="density" data-value="compact">Tight</button>
              <button class="format-option" data-setting="density" data-value="normal">Normal</button>
              <button class="format-option" data-setting="density" data-value="spacious">Airy</button>
            </div>
          </div>

          <!-- Margins -->
          <div class="finetune-group">
            <label class="format-section-label">Margins</label>
            <div class="finetune-btn-row">
              <button class="format-option" data-setting="margins" data-value="narrow">Narrow</button>
              <button class="format-option" data-setting="margins" data-value="normal">Normal</button>
              <button class="format-option" data-setting="margins" data-value="wide">Wide</button>
            </div>
          </div>

          <!-- Size Sliders -->
          <div class="finetune-group">
            <label class="format-section-label">Name Size</label>
            <div class="slider-row">
              <input type="range" id="nameSizeSlider" min="16" max="28" value="21" step="1">
              <span id="nameSizeValue" class="slider-value">21pt</span>
            </div>
          </div>

          <div class="finetune-group">
            <label class="format-section-label">Body Text</label>
            <div class="slider-row">
              <input type="range" id="bodySizeSlider" min="9" max="14" value="10" step="0.5">
              <span id="bodySizeValue" class="slider-value">10pt</span>
            </div>
          </div>

          <div class="finetune-group">
            <label class="format-section-label">Section Headers</label>
            <div class="slider-row">
              <input type="range" id="headerSizeSlider" min="10" max="24" value="12" step="1">
              <span id="headerSizeValue" class="slider-value">12pt</span>
            </div>
          </div>

          <div class="finetune-group">
            <label class="format-section-label">Sub-headings</label>
            <div class="slider-row">
              <input type="range" id="subheaderSizeSlider" min="10" max="18" value="11" step="0.5">
              <span id="subheaderSizeValue" class="slider-value">11pt</span>
            </div>
          </div>

          <!-- Header Style -->
          <div class="finetune-group">
            <label class="format-section-label">Header Style</label>
            <select id="headerStyleSelect" class="finetune-select">
              <option value="uppercase_line">UPPERCASE + Line</option>
              <option value="uppercase_noline">UPPERCASE Only</option>
              <option value="bold_line">Bold Title Case + Line</option>
              <option value="bold_noline">Bold Title Case Only</option>
            </select>
          </div>

          <!-- Bullet & Page -->
          <div class="finetune-row-split">
            <div class="finetune-group" style="flex:1;">
              <label class="format-section-label">Bullets</label>
              <div class="finetune-btn-row">
                <button class="format-option" data-setting="bulletChar" data-value="‚Ä¢">‚Ä¢</button>
                <button class="format-option" data-setting="bulletChar" data-value="‚Äì">‚Äì</button>
              </div>
            </div>
            <div class="finetune-group" style="flex:1;">
              <label class="format-section-label">Page Size</label>
              <div class="finetune-btn-row">
                <button class="format-option" data-setting="pageSize" data-value="letter">Letter</button>
                <button class="format-option" data-setting="pageSize" data-value="a4">A4</button>
              </div>
            </div>
          </div>

          <!-- Show Links -->
          <div class="finetune-group">
            <label class="finetune-checkbox-label">
              <input type="checkbox" id="showLinksCheck" checked>
              <span>Show clickable links in contact line</span>
            </label>
          </div>

        </div>
      </details>

      <!-- Footer Actions -->
      <div class="format-footer">
        <button id="previewFormatBtn" class="format-preview-btn">üëÅ Preview</button>
        <button id="resetFormatBtn" class="format-reset-btn">‚Ü© Reset</button>
      </div>
    </div>

    <!-- History UI -->
    <div id="historyUI" class="hidden card">
      <div class="flex-between" style="margin-bottom: 12px;">
        <h3>Resume History</h3>
        <button id="closeHistoryBtn" class="secondary-btn icon-btn">‚úï</button>
      </div>
      <div id="historyList"></div>
    </div>

    <!-- Editor UI -->
    <div id="editorUI" class="hidden">
      <!-- Editor Header ‚Äî compact -->
      <div class="editor-header">
        <div class="editor-header-left">
          <h3 class="editor-title">Edit Resume</h3>
          <span id="atsScoreBadge" class="ats-badge" style="display:none;"></span>
        </div>
        <div class="editor-header-actions">
          <button id="reorderBtn" class="editor-icon-btn" title="Reorder sections">‚áÖ</button>
          <button id="popoutEditorBtn" class="editor-icon-btn" title="Open in full editor">‚Üó</button>
        </div>
      </div>

      <!-- Reorder Box (hidden by default) -->
      <div id="reorderUI" class="hidden card" style="background:#f1f5f9;">
        <h4 style="font-size:13px; margin-bottom:10px;">Drag to Reorder</h4>
        <ul id="sortableSections" style="list-style:none; padding:0; margin:0 0 10px 0;"></ul>
        <div class="flex-between" style="gap:8px;">
          <button id="saveOrderBtn" class="primary-btn" style="flex:1;">Save</button>
          <button id="cancelOrderBtn" class="secondary-btn" style="flex:1;">Cancel</button>
        </div>
      </div>

      <!-- Section Selector ‚Äî clean dropdown -->
      <div class="editor-section-selector">
        <select id="sectionSelect" class="editor-section-dropdown">
          <optgroup label="Sections">
            <option value="summary">Summary</option>
            <option value="education">Education</option>
            <option value="skills">Skills</option>
            <option value="experience">Experience</option>
            <option value="projects">Projects</option>
            <option value="leadership">Leadership</option>
            <option value="research">Research & Publications</option>
            <option value="certifications">Certifications</option>
            <option value="awards">Awards & Honors</option>
            <option value="volunteering">Volunteering</option>
            <option value="languages">Languages</option>
            <option value="contact">Contact Info</option>
          </optgroup>
        </select>
      </div>

      <!-- Editor Form Content ‚Äî scrollable -->
      <div id="formContainer" class="editor-form-scroll"></div>

      <!-- Sticky Footer ‚Äî simplified to 3 buttons -->
      <div class="editor-footer">
        <div class="editor-footer-primary">
          <button id="saveManualBtn" class="editor-save-btn">
            <span>üíæ Save</span>
          </button>
          <button id="saveRegenBtn" class="editor-regen-btn">
            <span>‚ú® Save & Re-tailor</span>
          </button>
        </div>
        <button id="cancelEditBtn" class="editor-cancel-btn">Cancel</button>
      </div>
    </div>

    <!-- Analysis Results -->
    <div id="analysisResults" class="hidden card" style="margin-top:16px;">
      <h3 style="border-bottom:1px solid #e2e8f0; padding-bottom:8px;">ATS Analysis</h3>
      <div style="display: flex; align-items: center; gap:16px; margin-bottom: 12px;">
        <div id="atsScore">--</div>
        <div>
          <div style="font-weight:700; font-size:14px;">Match Score</div>
          <div class="text-sm text-muted">Analysis based on basic keywords</div>
        </div>
      </div>
      <div id="analysisDetails"></div>
    </div>

    <!-- Question Helper -->
    <div style="margin-top: 16px;">
      <details class="question-helper-details">
        <summary class="question-helper-toggle">
          <span>üí° Application Question Helper</span>
          <span class="toggle-chevron">‚ñæ</span>
        </summary>
        <div class="question-helper-content">
          <textarea id="questionInput" class="question-input"
            placeholder="Paste any application question here (e.g., &quot;Why are you interested in this role?&quot;)"></textarea>
          <div style="display:flex; justify-content:flex-end; margin-top:6px;">
            <button id="askBtn" class="primary-btn" style="font-size:11px; padding:6px 14px;">‚ú® Generate Answer</button>
          </div>
          <div id="answerOutput" class="hidden answer-output"></div>
        </div>
      </details>
    </div>
  </div>

  <footer class="app-footer">
    <span>ForgeCV v1.0.1</span>
    <span class="footer-dot">¬∑</span>
    <span>Data stays on your device</span>
    <span class="footer-dot">¬∑</span>
    <a href="https://www.linkedin.com/in/pranay-saggar" target="_blank">By Pranay Saggar</a>
  </footer>

  <div id="toastContainer"
    style="position:fixed; top:12px; right:12px; z-index:1000; display:flex; flex-direction:column; gap:8px; pointer-events:none;">
  </div>

  <!-- Scripts -->
  <script src="jspdf.umd.min.js"></script>
  <script type="module" src="pdf_init.js"></script>
  <script type="module" src="popup.js"></script>
</body>

</html>