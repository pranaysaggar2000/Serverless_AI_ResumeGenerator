<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <header>
    <div class="logo">
      <span>üìÑ</span> ForgeCV
    </div>
    <div class="controls">
      <button id="profileToggle" class="icon-btn" title="Manage Profile">üë§</button>
      <button id="settingsToggle" class="icon-btn" title="Settings">‚öôÔ∏è</button>
    </div>
  </header>

  <div id="status"></div>

  <!-- Settings UI -->
  <div id="settingsUI" class="hidden">
    <div class="flex-between" style="margin-bottom: 16px;">
      <h3>Settings</h3>
      <button id="backFromSettings" class="secondary-btn icon-btn"
        style="width:auto; padding: 4px 8px; font-size:11px;">‚úï</button>
    </div>

    <div class="settings-card">
      <div class="edit-field">
        <label for="providerSelect">AI Provider</label>
        <select id="providerSelect">
          <option value="gemini">Google Gemini (Recommended)</option>
          <option value="groq">Groq (Llama 3)</option>
        </select>
      </div>

      <div id="geminiKeyData" class="key-section">
        <label for="apiKey">Gemini API Key</label>
        <div style="position:relative;">
          <input type="password" id="apiKey" placeholder="Enter Gemini API Key">
        </div>
        <div class="text-sm text-muted" style="margin-top:4px;">
          Get key from <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>.
        </div>
      </div>

      <div id="groqKeyData" class="key-section hidden">
        <label for="groqApiKey">Groq API Key</label>
        <input type="password" id="groqApiKey" placeholder="Enter Groq API Key">
        <div class="text-sm text-muted" style="margin-top:4px;">
          Get key from <a href="https://console.groq.com/keys" target="_blank">Groq Console</a>.
        </div>
      </div>

      <button id="saveSettingsBtn" class="primary-btn" style="width:100%; margin-top:16px;">Save Settings</button>
      <div id="settingsStatus"></div>
    </div>
  </div>

  <!-- Profile Management UI -->
  <div id="profileUI" class="hidden">
    <div class="flex-between" style="margin-bottom: 16px;">
      <h3>Manage Profile</h3>
      <button id="backFromProfile" class="secondary-btn icon-btn"
        style="width:auto; padding: 4px 8px; font-size:11px;">‚úï</button>
    </div>

    <div class="card">
      <h4 style="margin-bottom:12px;">üìÑ Re-upload Base Resume</h4>
      <input type="file" id="reuploadResumeFile" accept=".pdf" style="margin-bottom:10px;">
      <button id="reuploadBtn" class="primary-btn" style="width:100%;">Upload New Resume</button>

      <div class="divider-or"><span>OR PASTE TEXT</span></div>

      <textarea id="reuploadResumeText" placeholder="Paste full resume text..." style="height: 80px;"></textarea>
      <button id="reuploadTextBtn" class="primary-btn" style="width:100%; margin-top:8px;">Process Text</button>
    </div>

    <div class="card">
      <h4 style="margin-bottom:12px;">‚úèÔ∏è Manual Edit</h4>
      <label for="profileSectionSelect" class="text-sm text-muted">Select Section:</label>
      <select id="profileSectionSelect" style="margin-bottom:12px;">
        <option value="contact">Contact Info</option>
        <option value="education">Education</option>
        <option value="experience">Experience</option>
        <option value="projects">Projects</option>
        <option value="skills">Skills</option>
        <option value="leadership">Leadership</option>
        <option value="research">Research & Publications</option>
        <option value="certifications">Certifications</option>
        <option value="awards">Awards & Honors</option>
        <option value="volunteering">Volunteering</option>
        <option value="languages">Languages</option>
      </select>

      <div id="profileFormContainer" style="max-height: 400px; overflow-y: auto;"></div>

      <div class="flex-between" style="gap:10px; margin-top:16px;">
        <button id="saveProfileBtn" class="primary-btn" style="flex:1;">Save Changes</button>
        <button id="cancelProfileEditBtn" class="secondary-btn" style="flex:1;">Cancel</button>
      </div>
    </div>
    <div id="profileStatus"></div>
  </div>

  <!-- Setup UI -->
  <div id="setupUI" class="hidden">
    <div class="upload-zone">
      <h2 style="font-size:18px; margin-bottom:8px;">Welcome to ForgeCV</h2>
      <p class="text-muted" style="margin-bottom:20px;">Upload your resume to get started.</p>

      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0;">Setup</h3>
        <button id="backFromSetup" class="secondary-btn" style="font-size:11px; padding:4px 8px;">Back</button>
      </div>

      <input type="file" id="resumeFile" accept=".pdf" style="margin: 16px 0;">
      <button id="uploadBtn" class="primary-btn" style="width:100%;">Upload Resume</button>
      <div id="uploadStatus"></div>

      <div class="divider-or"><span>OR PASTE TEXT</span></div>

      <textarea id="resumeTextInit" placeholder="Paste resume text..." style="height: 100px;"></textarea>
      <button id="processTextInitBtn" class="primary-btn" style="width:100%; margin-top:8px;">Process Text</button>
      <div id="textStatus" style="margin-top:8px;"></div>
    </div>
  </div>

  <!-- Main UI -->
  <div id="mainUI" class="hidden">
    <div class="profile-pill">
      <span>Using:</span> <strong id="profileName">Loading...</strong>
    </div>

    <!-- Tailoring Strategy -->
    <div class="card">
      <label class="text-sm font-bold text-muted" style="display:block; margin-bottom:8px;">TAILORING BASIS</label>
      <input type="range" id="tailoringSlider" min="0" max="2" value="1" step="1">
      <div class="strategy-labels">
        <span>Profile Focus</span>
        <span>Balanced</span>
        <span>JD Focus</span>
      </div>
      <div id="strategyDescription" class="text-sm text-muted" style="margin-top:12px; font-style:italic;">
        Balanced approach - integrates JD keywords...
      </div>
    </div>

    <div style="display:flex; flex-direction:column; gap:8px;">
      <button id="generateBtn" class="primary-btn" style="padding:14px;">‚ö° Process Page & Generate Resume</button>
      <button id="generateBaseBtn" class="secondary-btn">Generate Base Resume (No AI)</button>
    </div>

    <!-- Actions (Post-Generation) -->
    <div id="actions" class="hidden">
      <div class="actions-grid">
        <button id="previewBtn">üëÅÔ∏è Preview PDF</button>
        <button id="downloadBtn">üì• Download PDF</button>
        <button id="editBtn">‚úèÔ∏è Edit Resume</button>
        <button id="copyContentBtn">üìã Copy Content</button>
        <button id="analyzeBtn">üìä Analyze ATS Score</button>
      </div>
    </div>

    <!-- Copy UI -->
    <div id="copyUI" class="hidden card">
      <div class="flex-between">
        <h3>Copy Content</h3>
        <button id="closeCopyBtn" class="secondary-btn icon-btn">‚úï</button>
      </div>
      <div id="copyList"></div>
    </div>

    <!-- Editor UI -->
    <div id="editorUI" class="hidden">
      <div class="flex-between" style="margin-bottom:12px;">
        <h3>Edit Resume Content</h3>
        <button id="reorderBtn"
          style="background:none; border:none; color:var(--primary); font-size:12px; cursor:pointer;">‚áÖ Reorder
          Sections</button>
      </div>

      <!-- Reorder Box -->
      <div id="reorderUI" class="hidden card" style="background:#f1f5f9;">
        <h4 style="font-size:13px; margin-bottom:10px;">Drag to Reorder</h4>
        <ul id="sortableSections" style="list-style:none; padding:0; margin:0 0 10px 0;"></ul>
        <div class="flex-between" style="gap:8px;">
          <button id="saveOrderBtn" class="primary-btn" style="flex:1;">Save</button>
          <button id="cancelOrderBtn" class="secondary-btn" style="flex:1;">Cancel</button>
        </div>
      </div>

      <div class="edit-field">
        <select id="sectionSelect">
          <optgroup label="Sections">
            <option value="summary">Summary</option>
            <option value="education">Education</option>
            <option value="skills">Skills</option>
            <option value="experience">Experience</option>
            <option value="projects">Projects</option>
            <option value="leadership">Leadership</option>
            <option value="research">Research & Publications</option>
            <option value="certifications">Certifications</option>
            <option value="awards">Awards & Honors</option>
            <option value="volunteering">Volunteering</option>
            <option value="languages">Languages</option>
            <option value="contact">Contact Info (Location/Links)</option>
          </optgroup>
        </select>
      </div>

      <div id="formContainer" style="max-height: 400px; overflow-y: auto; padding-bottom: 20px;"></div>

      <div class="editor-footer">
        <button id="saveManualBtn" style="background:var(--primary); color:white;">Save Changes</button>
        <button id="saveRegenBtn" style="background:var(--success); color:white;">Save & Regenerate</button>
        <button id="cancelEditBtn" class="secondary-btn">Cancel</button>
      </div>
    </div>

    <!-- Analysis Results -->
    <div id="analysisResults" class="hidden card" style="margin-top:16px;">
      <h3 style="border-bottom:1px solid #e2e8f0; padding-bottom:8px;">ATS Analysis</h3>
      <div style="display: flex; align-items: center; gap:16px; margin-bottom: 12px;">
        <div id="atsScore">--</div>
        <div>
          <div style="font-weight:700; font-size:14px;">Match Score</div>
          <div class="text-sm text-muted">Analysis based on basic keywords</div>
        </div>
      </div>
      <div id="analysisDetails"></div>
    </div>

    <!-- Question Helper -->
    <div style="margin-top: 20px;">
      <details class="card" style="padding:0; overflow:hidden;">
        <summary
          style="padding:12px; font-weight:600; cursor:pointer; list-style:none; display:flex; justify-content:space-between; align-items:center;">
          üí° Application Question Helper <span style="font-size:10px;">‚ñº</span>
        </summary>
        <div style="padding:16px; border-top:1px solid #f1f5f9;">
          <textarea id="questionInput" placeholder="Paste application question..."
            style="height:60px; margin-bottom:8px;"></textarea>
          <div style="display:flex; justify-content:flex-end;">
            <button id="askBtn" class="primary-btn" style="font-size:12px; padding:6px 12px;">Generate Answer</button>
          </div>
          <div id="answerOutput" class="hidden" style="margin-top:12px;"></div>
        </div>
      </details>
    </div>
  </div>

  <div id="error" class="error"></div>

  <!-- Scripts -->
  <script src="loader.js"></script>
</body>

</html>