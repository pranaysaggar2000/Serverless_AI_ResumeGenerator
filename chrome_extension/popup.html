<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <div style="text-align: center; padding: 2px 0; font-size: 9px; color: var(--text-muted); letter-spacing: 0.3px;">
    Built by <a href="https://www.linkedin.com/in/pranay-saggar" target="_blank"
      style="color: var(--primary); text-decoration: none; font-weight: 600;">Pranay Saggar</a>
    ¬∑ <a href="https://pranaysaggar.vercel.app/" target="_blank"
      style="color: var(--text-muted); text-decoration: none;">Portfolio</a>
  </div>
  <header>
    <div class="logo">
      <span>üìÑ</span> ForgeCV
    </div>
    <div class="controls">
      <button id="profileToggle" class="icon-btn" title="Manage Profile">üë§</button>
      <button id="settingsToggle" class="icon-btn" title="Settings">‚öôÔ∏è</button>
    </div>
  </header>

  <div id="status"></div>

  <!-- Settings UI -->
  <div id="settingsUI" class="hidden">
    <div class="flex-between" style="margin-bottom: 16px;">
      <p class="text-sm text-muted" style="margin-bottom: 12px;">Pick your AI brain and plug in a key. Takes 30 seconds.
        Your key stays on YOUR device ‚Äî pinky promise. ü§ô</p>
      <button id="backFromSettings" class="secondary-btn icon-btn"
        style="width:auto; padding: 4px 8px; font-size:11px;">‚úï</button>
    </div>

    <div class="settings-card">
      <div class="edit-field">
        <label for="providerSelect">AI Provider</label>
        <select id="providerSelect">
          <option value="gemini">Google Gemini (Recommended)</option>
          <option value="groq">Groq (Llama 3)</option>
        </select>
      </div>

      <div id="geminiKeyData" class="key-section">
        <label for="apiKey">Gemini API Key</label>
        <div style="position:relative;">
          <input type="password" id="apiKey" placeholder="Enter Gemini API Key">
        </div>
        <details class="help-details">
          <summary>How to get a Free Gemini API Key</summary>
          <div style="margin-bottom:8px; font-weight:600; color:var(--success);">‚ú® One-time setup. Using free tier.
          </div>
          <ol>
            <li>Go to <a href="https://aistudio.google.com/app/apikey" target="_blank">Google AI Studio</a>.</li>
            <li>Click the blue <strong>"Get API key"</strong> button.</li>
            <li>Select <strong>"Create API key in new project"</strong>.</li>
            <li>Copy the key that starts with <code>AIza...</code> and paste it above.</li>
          </ol>
          <div class="ask-ai-box">
            <div class="ask-ai-label">üôã Still stuck? Copy & Paste this into ChatGPT/Claude:</div>
            <div class="ask-ai-prompt" onclick="navigator.clipboard.writeText(this.innerText); alert('Copied!')">
              "Explain how to get a free Google Gemini API Key like I'm 5 years old and easily confused by buttons. Walk
              me through every click starting from opening Google."
            </div>
            <div style="text-align:right; font-size:9px; color:var(--primary); margin-top:2px;">(Click to copy)</div>
          </div>
        </details>
      </div>

      <div id="groqKeyData" class="key-section hidden">
        <label for="groqApiKey">Groq API Key</label>
        <input type="password" id="groqApiKey" placeholder="Enter Groq API Key">
        <details class="help-details">
          <summary>How to get a Free Groq Key</summary>
          <div style="margin-bottom:8px; font-weight:600; color:var(--success);">‚ú® One-time setup. Using free tier.
          </div>
          <ol>
            <li>Go to <a href="https://console.groq.com/keys" target="_blank">Groq Console</a>.</li>
            <li><strong>Important:</strong> Sign up using <strong>Google</strong> or <strong>GitHub</strong> (Email
              signup often fails).</li>
            <li>Click <strong>"Create API Key"</strong>.</li>
            <li>Name it "Resume" and copy the key starting with <code>gsk_...</code>.</li>
          </ol>
          <div class="ask-ai-box">
            <div class="ask-ai-label">üôã Still stuck? Copy & Paste this into ChatGPT/Claude:</div>
            <div class="ask-ai-prompt" onclick="navigator.clipboard.writeText(this.innerText); alert('Copied!')">
              "Explain how to get a free Groq API Key like I'm a time traveler from 1995 who just discovered the
              internet. Be super specific about clicking 'Create API Key'."
            </div>
            <div style="text-align:right; font-size:9px; color:var(--primary); margin-top:2px;">(Click to copy)</div>
          </div>
        </details>
      </div>

      <button id="saveSettingsBtn" class="primary-btn" style="width:100%; margin-top:16px;">Save Settings</button>
      <button id="skipSettingsBtn" class="secondary-btn" style="width:100%; margin-top:8px;">Skip for now</button>
      <div id="settingsStatus"></div>
    </div>
  </div>

  <!-- Profile Management UI -->
  <div id="profileUI" class="hidden">
    <div class="flex-between" style="margin-bottom: 16px;">
      <h3>Manage Profile</h3>
      <button id="backFromProfile" class="secondary-btn icon-btn"
        style="width:auto; padding: 4px 8px; font-size:11px;">‚úï</button>
    </div>

    <div class="card" style="margin-bottom: 12px;">
      <h4 style="margin-bottom: 10px;">üìÇ Profiles</h4>
      <div id="profileList" style="margin-bottom: 10px;"></div>
      <div style="display: flex; gap: 8px;">
        <input type="text" id="newProfileName" placeholder="New profile name..."
          style="flex: 1; font-size: 12px; padding: 8px;">
        <button id="createProfileBtn" class="secondary-btn"
          style="white-space: nowrap; font-size: 12px; padding: 8px 12px;">+ Create</button>
      </div>
    </div>

    <div class="card">
      <h4 style="margin-bottom:12px;">üìÑ Re-upload Base Resume</h4>
      <input type="file" id="reuploadResumeFile" accept=".pdf" style="margin-bottom:10px;">
      <button id="reuploadBtn" class="primary-btn" style="width:100%;">Upload New Resume</button>

      <div class="divider-or"><span>OR LINKEDIN</span></div>

      <div style="margin-bottom:12px;">
        <label
          style="font-size:11px; font-weight:600; color:var(--text-secondary); display:block; margin-bottom:6px;">Upload
          LinkedIn PDF</label>
        <div style="display:flex; gap:8px; align-items:center;">
          <input type="file" id="reuploadLinkedinPdf" accept=".pdf" style="flex:1;">
          <button id="reuploadLinkedinPdfBtn" class="primary-btn"
            style="white-space:nowrap; padding:8px 12px; font-size:11px;">Upload</button>
        </div>
      </div>

      <div>
        <label
          style="font-size:11px; font-weight:600; color:var(--text-secondary); display:block; margin-bottom:6px;">Or
          paste LinkedIn URL</label>
        <div style="display:flex; gap:8px;">
          <input type="text" id="reuploadLinkedinUrl" placeholder="https://linkedin.com/in/..."
            style="flex:1; font-size:11px;">
          <button id="reuploadLinkedinUrlBtn" class="secondary-btn"
            style="white-space:nowrap; padding:8px 12px; font-size:11px;">üîç Fetch</button>
        </div>
      </div>

      <div class="divider-or"><span>OR PASTE TEXT</span></div>

      <textarea id="reuploadResumeText" placeholder="Paste full resume text..." style="height: 80px;"></textarea>
      <button id="reuploadTextBtn" class="primary-btn" style="width:100%; margin-top:8px;">Process Text</button>
    </div>

    <div class="card">
      <h4 style="margin-bottom:12px;">‚úèÔ∏è Manual Edit</h4>
      <label for="profileSectionSelect" class="text-sm text-muted">Select Section:</label>
      <select id="profileSectionSelect" style="margin-bottom:12px;">
        <option value="summary">Summary</option>
        <option value="contact">Contact Info</option>
        <option value="education">Education</option>
        <option value="experience">Experience</option>
        <option value="projects">Projects</option>
        <option value="skills">Skills</option>
        <option value="leadership">Leadership</option>
        <option value="research">Research & Publications</option>
        <option value="certifications">Certifications</option>
        <option value="awards">Awards & Honors</option>
        <option value="volunteering">Volunteering</option>
        <option value="languages">Languages</option>
      </select>

      <div id="profileFormContainer" style="max-height: 400px; overflow-y: auto;"></div>

      <div class="flex-between" style="gap:10px; margin-top:16px;">
        <button id="saveProfileBtn" class="primary-btn" style="flex:1;">Save Changes</button>
        <button id="cancelProfileEditBtn" class="secondary-btn" style="flex:1;">Cancel</button>
      </div>
    </div>
    <div id="profileStatus"></div>
  </div>

  <!-- Setup UI -->
  <div id="setupUI" class="hidden">
    <div class="upload-zone">
      <h2 style="font-size:18px; margin-bottom:4px;">Welcome to ForgeCV</h2>
      <p class="text-muted" style="margin-bottom:4px; font-size: 12px;">AI-powered resume tailoring in 3 steps:</p>
      <div
        style="text-align: left; margin: 0 auto 16px; max-width: 260px; font-size: 11px; color: var(--text-secondary);">
        <div style="margin-bottom: 4px;">1Ô∏è‚É£ Upload your base resume (PDF or text)</div>
        <div style="margin-bottom: 4px;">2Ô∏è‚É£ Navigate to a job posting page</div>
        <div>3Ô∏è‚É£ Click "Generate" ‚Äî AI tailors your resume to the job</div>
      </div>

      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0;">Setup</h3>
        <button id="backFromSetup" class="secondary-btn" style="font-size:11px; padding:4px 8px;">Back</button>
      </div>

      <div class="input-method-tabs"
        style="display:flex; gap:0; margin-bottom:16px; border:1px solid var(--border-color); border-radius:var(--radius-md); overflow:hidden;">
        <button class="method-tab active" data-method="resume"
          style="flex:1; padding:10px 8px; font-size:11px; font-weight:600; border:none; cursor:pointer; background:var(--primary); color:white; transition:all 0.15s;">üìÑ
          Resume PDF</button>
        <button class="method-tab" data-method="linkedin"
          style="flex:1; padding:10px 8px; font-size:11px; font-weight:600; border:none; cursor:pointer; background:var(--card-bg); color:var(--text-secondary); border-left:1px solid var(--border-color); transition:all 0.15s;">üíº
          LinkedIn</button>
        <button class="method-tab" data-method="text"
          style="flex:1; padding:10px 8px; font-size:11px; font-weight:600; border:none; cursor:pointer; background:var(--card-bg); color:var(--text-secondary); border-left:1px solid var(--border-color); transition:all 0.15s;">üìù
          Paste Text</button>
      </div>

      <!-- Resume PDF Tab (default, visible) -->
      <div id="methodResume" class="method-panel">
        <input type="file" id="resumeFile" accept=".pdf" style="margin-bottom:12px;">
        <button id="uploadBtn" class="primary-btn" style="width:100%;">Upload Resume</button>
        <div id="uploadStatus"></div>
      </div>

      <!-- LinkedIn Tab (hidden) -->
      <div id="methodLinkedin" class="method-panel" style="display:none;">
        <div style="margin-bottom:16px;">
          <label
            style="font-size:12px; font-weight:600; color:var(--text-main); display:block; margin-bottom:8px;">Upload
            LinkedIn PDF</label>
          <input type="file" id="linkedinPdfFile" accept=".pdf" style="margin-bottom:8px;">
          <button id="uploadLinkedinPdfBtn" class="primary-btn" style="width:100%;">Upload LinkedIn PDF</button>
          <details style="margin-top:8px; font-size:11px; color:var(--text-muted);">
            <summary style="cursor:pointer; font-weight:500; color:var(--primary);">How to export your LinkedIn PDF
            </summary>
            <div style="padding:8px 0; line-height:1.6;">
              <ol style="margin:4px 0 0 16px; padding:0;">
                <li>Go to your <a href="https://www.linkedin.com/in/me" target="_blank">LinkedIn profile</a></li>
                <li>Click the <strong>"More"</strong> button (below your banner)</li>
                <li>Select <strong>"Save to PDF"</strong></li>
                <li>Upload the downloaded PDF here</li>
              </ol>
              <div
                style="margin-top:8px; padding:6px 8px; background:#f0fdf4; border-radius:4px; border:1px solid #a7f3d0; font-size:10px;">
                ‚úÖ This is the most reliable method ‚Äî captures your full profile including all experience, education,
                skills, and certifications.
              </div>
            </div>
          </details>
        </div>

        <div class="divider-or"><span>OR</span></div>

        <div>
          <label
            style="font-size:12px; font-weight:600; color:var(--text-main); display:block; margin-bottom:8px;">Paste
            LinkedIn URL</label>
          <div style="display:flex; gap:8px;">
            <input type="text" id="linkedinUrlInput" placeholder="https://linkedin.com/in/your-name"
              style="flex:1; font-size:12px;">
            <button id="fetchLinkedinBtn" class="primary-btn"
              style="white-space:nowrap; padding:10px 14px; font-size:12px;">üîç Fetch</button>
          </div>
          <div style="margin-top:6px; font-size:10px; color:var(--text-muted); line-height:1.4;">
            ‚ö†Ô∏è Works with public profiles only. LinkedIn may limit data visibility. If results are incomplete, try the
            PDF method above.
          </div>
          <div id="linkedinUrlStatus" style="margin-top:8px;"></div>
        </div>
      </div>

      <!-- Paste Text Tab (hidden) -->
      <div id="methodText" class="method-panel" style="display:none;">
        <textarea id="resumeTextInit" placeholder="Paste your full resume text here..."
          style="height:120px;"></textarea>
        <button id="processTextInitBtn" class="primary-btn" style="width:100%; margin-top:8px;">Process Text</button>
        <div id="textStatus" style="margin-top:8px;"></div>
      </div>
      <details style="margin-top: 16px; text-align: left;">
        <summary style="font-size: 12px; font-weight: 600; cursor: pointer; color: var(--primary);">‚ÑπÔ∏è How does ForgeCV
          work?</summary>
        <div style="font-size: 11px; color: var(--text-secondary); padding: 10px 0; line-height: 1.6;">
          <p><strong>Your data is private.</strong> Your resume and API key stay on your device. We never store or
            transmit your personal information.</p>
          <p><strong>Step 1:</strong> Upload your resume once. ForgeCV extracts and stores your profile locally.</p>
          <p><strong>Step 2:</strong> Open any job posting in your browser. ForgeCV automatically reads the job
            description from the page.</p>
          <p><strong>Step 3:</strong> Click Generate. AI rewrites your resume to match the job's keywords while
            preserving your real experience.</p>
          <p><strong>Step 4:</strong> Download the tailored PDF, or drag it directly into the application form.</p>
        </div>
      </details>
      <div style="margin-top: 12px; text-align: center; font-size: 10px; color: var(--text-muted);">
        ‚ú® Trusted by job seekers. Powered by AI. Zero data leaves your device.
      </div>
    </div>
  </div>

  <!-- Main UI -->
  <div id="mainUI" class="hidden">
    <div class="profile-pill">
      <span>Using:</span> <strong id="profileName">Loading...</strong>
      <span id="atsScoreBadge" class="ats-badge" style="display:none;"></span>
      <span id="activeProfileLabel" style="font-size:10px; opacity:0.7; margin-left:4px;"></span>
    </div>

    <!-- JD Source Card -->
    <div id="jdStatusCard" class="card" style="padding: 12px 14px; margin-bottom: 12px;">
      <!-- Active Tab Display -->
      <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
        <span id="jdStatusDot"
          style="width: 8px; height: 8px; border-radius: 50%; background: #9ca3af; flex-shrink: 0;"></span>
        <div style="flex: 1; min-width: 0;">
          <div id="jdStatusText"
            style="font-size: 11px; font-weight: 600; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
            No job description loaded</div>
          <div id="jdSourceUrl"
            style="font-size: 9px; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 1px;">
          </div>
        </div>
      </div>

      <!-- Active Tab Label -->
      <div id="activeTabLabel"
        style="font-size: 9px; color: var(--text-muted); background: #f9fafb; padding: 4px 8px; border-radius: 4px; margin-bottom: 8px; display: flex; align-items: center; gap: 4px;">
        <span>üåê</span>
        <span id="activeTabUrl" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">Loading current
          tab...</span>
      </div>

      <!-- Two Action Buttons -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px;">
        <button id="fetchJdBtn" class="secondary-btn" style="font-size: 11px; padding: 8px 6px; gap: 4px;"
          title="Scans the current browser tab for a job description">
          üîç Fetch from Page
        </button>
        <button id="manualJdBtn" class="secondary-btn" style="font-size: 11px; padding: 8px 6px; gap: 4px;"
          title="Paste a job description or upload a JD as PDF">
          üìù Add JD Manually
        </button>
      </div>

      <!-- Manual JD Input (hidden by default) -->
      <div id="manualJdInput"
        style="display: none; margin-top: 10px; border-top: 1px solid var(--border-color); padding-top: 10px;">
        <textarea id="manualJdText" placeholder="Paste the full job description text here..."
          style="height: 120px; font-size: 12px;"></textarea>
        <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
          <span style="font-size: 10px; color: var(--text-muted);">or</span>
          <label style="font-size: 11px; color: var(--primary); cursor: pointer; font-weight: 500;" for="jdPdfFile">üìé
            Upload JD PDF</label>
          <input type="file" id="jdPdfFile" accept=".pdf" style="display: none;">
          <span id="jdPdfFileName" style="font-size: 10px; color: var(--text-secondary);"></span>
        </div>
        <div style="display: flex; gap: 6px; margin-top: 10px;">
          <button id="saveManualJdBtn" class="primary-btn" style="flex: 1; font-size: 11px; padding: 8px;">‚úÖ Use This
            JD</button>
          <button id="cancelManualJdBtn" class="secondary-btn"
            style="flex: 1; font-size: 11px; padding: 8px;">Cancel</button>
        </div>
      </div>

      <!-- Current JD Preview & Edit (expands) -->
      <div id="jdPreviewContainer"
        style="display: none; margin-top: 10px; border-top: 1px solid var(--border-color); padding-top: 10px;">
        <div class="flex-between" style="margin-bottom: 6px;">
          <span style="font-size: 10px; font-weight: 600; color: var(--text-muted);">CURRENT JD</span>
          <button id="toggleJdPreviewBtn" class="secondary-btn"
            style="width: auto; padding: 2px 6px; font-size: 9px; height: 18px;">Expand View</button>
        </div>

        <div style="position: relative;">
          <textarea id="jdPreviewText"
            style="width: 100%; height: auto; min-height: 48px; max-height: 48px; font-size: 11px; padding: 6px; line-height: 1.4; border-radius: 4px; overflow-y: hidden; transition: max-height 0.2s ease-in-out; background: #fdfdfd; border: 1px solid #eee;"
            placeholder="No JD content loaded..."></textarea>
          <div id="jdEditSaveContainer" style="display: none; position: absolute; bottom: 4px; right: 4px; z-index: 5;">
            <button id="saveJdEditBtn" class="primary-btn"
              style="padding: 4px 8px; font-size: 9px; height: 22px; width: auto;">Save Changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Tailoring Strategy -->
    <div class="card">
      <label class="text-sm font-bold text-muted" style="display:block; margin-bottom:8px;">TAILORING BASIS</label>
      <input type="range" id="tailoringSlider" min="0" max="2" value="1" step="1">
      <div class="strategy-labels">
        <span>üõ° Keep It Real</span>
        <span>‚öñÔ∏è Sweet Spot</span>
        <span>üéØ ATS Destroyer</span>
      </div>
      <div id="strategyDescription" class="text-sm text-muted" style="margin-top:12px; font-style:italic;">
        Balanced approach - integrates JD keywords...
      </div>
    </div>

    <div style="display:flex; flex-direction:column; gap:8px;">
      <button id="generateBtn" class="primary-btn" style="padding:14px; font-size: 14px;"
        title="AI reads the job description and tailors your resume for maximum ATS match">
        üî• Forge My Resume
      </button>
      <button id="generateBaseBtn" class="secondary-btn" style="font-size: 12px;"
        title="Generate a clean PDF from your base profile without AI tailoring">
        üìÑ Export Base Resume (No AI)
      </button>
    </div>

    <!-- Actions (Post-Generation) -->
    <div id="actions" class="hidden">
      <div class="actions-grid">
        <button id="previewBtn" class="grid-preview">üîç Preview</button>
        <button id="downloadBtn" class="grid-download">‚¨á Download</button>
        <button id="editBtn" class="grid-edit">‚úèÔ∏è Fine-Tune</button>
        <button id="formatBtn" class="grid-style secondary-btn">üé® Style It</button>
        <button id="copyContentBtn" class="grid-copy">üìã Copy</button>
        <button id="analyzeBtn" class="grid-analyze secondary-btn">üìä ATS Score</button>
        <button id="historyBtn" class="grid-history secondary-btn">üï∞ Past Forges</button>
      </div>

      <!-- Drag & Drop Resume Card -->
      <div id="dragCard" class="hidden" style="margin-top: 12px;">
        <div id="dragHandle" style="
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                padding: 14px 16px;
                background: linear-gradient(135deg, #f0f4ff 0%, #e8ecff 100%);
                border: 2px dashed #818cf8;
                border-radius: 10px;
                cursor: pointer;
                transition: all 0.2s;
                user-select: none;
            ">
          <span style="font-size: 20px;">üìÑ</span>
          <div>
            <div id="dragFileName" style="font-weight: 600; font-size: 12px; color: #4338ca;">Click to enable drag on
              page</div>
            <div style="font-size: 10px; color: #6366f1;">Injects a draggable pill into the current tab üìå</div>
          </div>
          <span style="font-size: 16px; color: #a5b4fc;">‚áó</span>
        </div>
      </div>

      <!-- Generation Progress -->
      <div id="generationProgress" class="hidden card" style="margin-top: 16px;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
          <div id="progressSpinner" class="spinner"></div>
          <span id="progressStepText" style="font-weight: 500; font-size: 13px;">Preparing...</span>
        </div>
        <div id="progressBar" style="height: 4px; background: #e5e7eb; border-radius: 2px; overflow: hidden;">
          <div id="progressFill"
            style="height: 100%; width: 0%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.5s ease;">
          </div>
        </div>
        <div id="progressDetail" class="text-sm text-muted" style="margin-top: 6px; font-size: 11px;"></div>
      </div>
      <div id="diffSummaryContainer"></div>
    </div>

    <!-- Copy UI -->
    <div id="copyUI" class="hidden card">
      <div class="flex-between">
        <h3>Copy Content</h3>
        <button id="closeCopyBtn" class="secondary-btn icon-btn">‚úï</button>
      </div>
      <div id="copyList"></div>
    </div>

    <!-- Format Settings UI -->
    <div id="formatUI" class="hidden card">
      <div class="flex-between" style="margin-bottom: 12px;">
        <h3>Resume Format</h3>
        <button id="closeFormatBtn" class="secondary-btn icon-btn">‚úï</button>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">FONT FAMILY</label>
        <div style="display: flex; gap: 6px;">
          <button class="format-option" data-setting="font" data-value="times"
            style="flex:1; font-family: 'Times New Roman', serif; font-size: 12px; padding: 8px;">Times</button>
          <button class="format-option" data-setting="font" data-value="helvetica"
            style="flex:1; font-family: Helvetica, Arial, sans-serif; font-size: 12px; padding: 8px;">Helvetica</button>
          <button class="format-option" data-setting="font" data-value="courier"
            style="flex:1; font-family: 'Courier New', monospace; font-size: 12px; padding: 8px;">Courier</button>
        </div>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">DENSITY</label>
        <div style="display: flex; gap: 6px;">
          <button class="format-option" data-setting="density" data-value="compact"
            style="flex:1; font-size: 11px; padding: 8px;">Compact</button>
          <button class="format-option" data-setting="density" data-value="normal"
            style="flex:1; font-size: 11px; padding: 8px;">Normal</button>
          <button class="format-option" data-setting="density" data-value="spacious"
            style="flex:1; font-size: 11px; padding: 8px;">Spacious</button>
        </div>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">MARGINS</label>
        <div style="display: flex; gap: 6px;">
          <button class="format-option" data-setting="margins" data-value="narrow"
            style="flex:1; font-size: 11px; padding: 8px;">Narrow</button>
          <button class="format-option" data-setting="margins" data-value="normal"
            style="flex:1; font-size: 11px; padding: 8px;">Normal</button>
          <button class="format-option" data-setting="margins" data-value="wide"
            style="flex:1; font-size: 11px; padding: 8px;">Wide</button>
        </div>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">NAME SIZE</label>
        <div style="display: flex; align-items: center; gap: 10px;">
          <input type="range" id="nameSizeSlider" min="16" max="28" value="21" step="1" style="flex: 1;">
          <span id="nameSizeValue" style="font-size: 12px; min-width: 30px; text-align: center;">21pt</span>
        </div>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">BODY TEXT SIZE</label>
        <div style="display: flex; align-items: center; gap: 10px;">
          <input type="range" id="bodySizeSlider" min="9" max="14" value="10" step="0.5" style="flex: 1;">
          <span id="bodySizeValue" style="font-size: 12px; min-width: 30px; text-align: center;">10pt</span>
        </div>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">SECTION HEADER SIZE</label>
        <div style="display: flex; align-items: center; gap: 10px;">
          <input type="range" id="headerSizeSlider" min="10" max="24" value="12" step="1" style="flex: 1;">
          <span id="headerSizeValue" style="font-size: 12px; min-width: 30px; text-align: center;">12pt</span>
        </div>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">SUB-HEADING SIZE</label>
        <div style="display: flex; align-items: center; gap: 10px;">
          <input type="range" id="subheaderSizeSlider" min="10" max="18" value="11" step="0.5" style="flex: 1;">
          <span id="subheaderSizeValue" style="font-size: 12px; min-width: 30px; text-align: center;">11pt</span>
        </div>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">SECTION HEADERS</label>
        <select id="headerStyleSelect" style="font-size: 12px;">
          <option value="uppercase_line">UPPERCASE + Line (Default)</option>
          <option value="uppercase_noline">UPPERCASE Only</option>
          <option value="bold_line">Bold Title Case + Line</option>
          <option value="bold_noline">Bold Title Case Only</option>
        </select>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">BULLET STYLE</label>
        <div style="display: flex; gap: 6px;">
          <button class="format-option" data-setting="bulletChar" data-value="‚Ä¢"
            style="flex:1; font-size: 14px; padding: 8px;">‚Ä¢</button>
          <button class="format-option" data-setting="bulletChar" data-value="‚Äì"
            style="flex:1; font-size: 14px; padding: 8px;">‚Äì</button>
        </div>
      </div>

      <div class="edit-field" style="margin-bottom: 12px;">
        <label class="text-sm text-muted">PAGE SIZE</label>
        <div style="display: flex; gap: 6px;">
          <button class="format-option" data-setting="pageSize" data-value="letter"
            style="flex:1; font-size: 11px; padding: 8px;">US Letter</button>
          <button class="format-option" data-setting="pageSize" data-value="a4"
            style="flex:1; font-size: 11px; padding: 8px;">A4</button>
        </div>
      </div>

      <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
        <input type="checkbox" id="showLinksCheck" checked style="width: auto;">
        <label for="showLinksCheck" class="text-sm" style="margin: 0;">Show clickable links in contact line</label>
      </div>

      <div style="display: flex; gap: 8px; margin-top: 16px;">
        <button id="previewFormatBtn" class="primary-btn" style="flex: 1; font-size: 12px;">üëÅ Preview</button>
        <button id="resetFormatBtn" class="secondary-btn" style="flex: 1; font-size: 12px;">‚Ü© Reset Defaults</button>
      </div>
    </div>

    <!-- History UI -->
    <div id="historyUI" class="hidden card">
      <div class="flex-between" style="margin-bottom: 12px;">
        <h3>Resume History</h3>
        <button id="closeHistoryBtn" class="secondary-btn icon-btn">‚úï</button>
      </div>
      <div id="historyList"></div>
    </div>

    <!-- Editor UI -->
    <div id="editorUI" class="hidden">
      <button id="popoutEditorBtn"
        style="width:100%; margin-bottom:10px; font-size:11px; padding:8px; background:#f0f4ff; border:1px dashed #818cf8; border-radius:8px; color:#4338ca; cursor:pointer;">
        ‚Üó Open in Full Editor (Recommended for detailed editing)
      </button>

      <div class="flex-between" style="margin-bottom:12px;">
        <div style="display:flex; align-items:center; gap:8px;">
          <h3>Edit Resume Content</h3>
        </div>
        <button id="reorderBtn"
          style="background:none; border:none; color:var(--primary); font-size:12px; cursor:pointer;">‚áÖ Reorder
          Sections</button>
      </div>

      <!-- Reorder Box -->
      <div id="reorderUI" class="hidden card" style="background:#f1f5f9;">
        <h4 style="font-size:13px; margin-bottom:10px;">Drag to Reorder</h4>
        <ul id="sortableSections" style="list-style:none; padding:0; margin:0 0 10px 0;"></ul>
        <div class="flex-between" style="gap:8px;">
          <button id="saveOrderBtn" class="primary-btn" style="flex:1;">Save</button>
          <button id="cancelOrderBtn" class="secondary-btn" style="flex:1;">Cancel</button>
        </div>
      </div>

      <div class="edit-field">
        <select id="sectionSelect">
          <optgroup label="Sections">
            <option value="summary">Summary</option>
            <option value="education">Education</option>
            <option value="skills">Skills</option>
            <option value="experience">Experience</option>
            <option value="projects">Projects</option>
            <option value="leadership">Leadership</option>
            <option value="research">Research & Publications</option>
            <option value="certifications">Certifications</option>
            <option value="awards">Awards & Honors</option>
            <option value="volunteering">Volunteering</option>
            <option value="languages">Languages</option>
            <option value="contact">Contact Info (Location/Links)</option>
          </optgroup>
        </select>
      </div>

      <div
        style="font-size: 10px; color: var(--text-muted); margin-bottom: 10px; padding: 6px 8px; background: #f9fafb; border-radius: 6px; border: 1px solid #f3f4f6;">
        üí° <strong>Tip:</strong> Edit bullets to include job-specific keywords. Use ‚Üë‚Üì arrows to reorder items. Press
        <kbd style="background:#e5e7eb; padding:1px 4px; border-radius:3px; font-size:9px;">Ctrl+S</kbd> to save.
      </div>

      <div id="formContainer" style="max-height: 400px; overflow-y: auto; padding-bottom: 20px;"></div>

      <div class="editor-footer">
        <button id="saveManualBtn" style="background:var(--primary); color:white;">Save Changes</button>
        <button id="saveRegenBtn" style="background:var(--success); color:white;">Save & Regenerate</button>
        <button id="editorPreviewBtn" class="secondary-btn">üëÅ Preview</button>
        <button id="cancelEditBtn" class="secondary-btn">Cancel</button>
      </div>
    </div>

    <!-- Analysis Results -->
    <div id="analysisResults" class="hidden card" style="margin-top:16px;">
      <h3 style="border-bottom:1px solid #e2e8f0; padding-bottom:8px;">ATS Analysis</h3>
      <div style="display: flex; align-items: center; gap:16px; margin-bottom: 12px;">
        <div id="atsScore">--</div>
        <div>
          <div style="font-weight:700; font-size:14px;">Match Score</div>
          <div class="text-sm text-muted">Analysis based on basic keywords</div>
        </div>
      </div>
      <div id="analysisDetails"></div>
    </div>

    <!-- Question Helper -->
    <div style="margin-top: 20px;">
      <details class="card" style="padding:0; overflow:hidden;">
        <summary
          style="padding:12px; font-weight:600; cursor:pointer; list-style:none; display:flex; justify-content:space-between; align-items:center;">
          üí° Application Question Helper <span style="font-size:10px;">‚ñº</span>
        </summary>
        <div style="padding:16px; border-top:1px solid #f1f5f9;">
          <textarea id="questionInput"
            placeholder="Paste any application question here (e.g., &quot;Why are you interested in this role?&quot; or &quot;Describe a time you led a team&quot;)"
            style="height:60px; margin-bottom:8px;"></textarea>
          <div style="display:flex; justify-content:flex-end;">
            <button id="askBtn" class="primary-btn" style="font-size:12px; padding:6px 12px;">Generate Answer</button>
          </div>
          <div id="answerOutput" class="hidden" style="margin-top:12px;"></div>
        </div>
      </details>
    </div>
  </div>

  <footer style="text-align: center; padding: 12px 0 4px; margin-top: 20px; border-top: 1px solid var(--border-color);">
    <div style="font-size: 9px; color: var(--text-muted);">
      ForgeCV v1.0 ¬∑ Your data stays on your device ¬∑ API keys are stored locally
    </div>
  </footer>

  <div id="toastContainer"
    style="position:fixed; top:12px; right:12px; z-index:1000; display:flex; flex-direction:column; gap:8px; pointer-events:none;">
  </div>

  <!-- Scripts -->
  <script src="jspdf.umd.min.js"></script>
  <script type="module" src="pdf_init.js"></script>
  <script src="loader.js"></script>
</body>

</html>